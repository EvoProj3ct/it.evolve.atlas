/* ========================================================================
   PORTAL (il gioco vive qui sotto tutto il resto della pagina)
   ======================================================================== */
.portalRoot {
    position: fixed;   /* ancorato al viewport */
    inset: 0;
    z-index: -1;       /* CHIAVE: sempre sotto ogni UI */
    pointer-events: none; /* il gioco non intercetta click */
}

/* ========================================================================
   LAYER DI GIOCO (tutti ‚Äúscoped‚Äù sotto .portalRoot per purezza modules)
   ======================================================================== */
.portalRoot :global(.space-ship-container) {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 80px;
}

.portalRoot :global(.ship-shape) {
    position: absolute;
    left: 0;
    bottom: 4px;
    width: 64px;
    height: 72px;
    filter: drop-shadow(0 0 10px var(--foreground));
}

.portalRoot :global(.bullet-layer) {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.portalRoot :global(.bullet) {
    position: absolute;
    top: 0;
    width: 4px;
    height: 20px;
    background: var(--foreground);
    box-shadow: 0 0 10px var(--foreground);
}

.portalRoot :global(.aliens-layer) {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

/* ========================================================================
   GHOST üëª
   ======================================================================== */
.portalRoot :global(.aliens-layer .alien.ghost .eye) {
    position: absolute;
    top: 36%;
    width: 16px;
    height: 16px;
    background: #fff;
    border-radius: 50%;
}
.portalRoot :global(.aliens-layer .alien.ghost .eye .pupil) {
    position: absolute;
    top: 40%;
    left: 40%;
    width: 6px;
    height: 6px;
    background: #000;
    border-radius: 50%;
}

/* ========================================================================
   INVADER üëæ (costruito a blocchi via JS)
   ======================================================================== */
.portalRoot :global(.aliens-layer .alien.invader) {
    position: absolute;
    background: transparent;
}

/* ========================================================================
   ESPLOSIONE ‚ÄúMATERICA & COMPATTA‚Äù
   Struttura DOM dentro .explosion:
     <span.explosion>
       <span.ex-core></span>
       <span.ex-halo></span>
       <span.ex-spark> x6 (direzioni radiali)
   ======================================================================== */
.portalRoot :global(.explosion) {
    position: absolute;
    width: 24px;             /* sovrascritti da JS */
    height: 24px;
    border-radius: 50%;
    pointer-events: none;
    animation: boom 0.9s ease-out forwards;
    will-change: transform, opacity;
}

/* nucleo denso: bianco ‚Üí colore pieno */
.portalRoot :global(.explosion .ex-core) {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: radial-gradient(circle, #fff 0%, #fff 18%, currentColor 35%);
    filter: saturate(1.3);
}

/* alone spesso/saturo */
.portalRoot :global(.explosion .ex-halo) {
    position: absolute;
    inset: -6px;
    border-radius: 50%;
    box-shadow:
            0 0 20px 8px currentColor,
            0 0 36px 14px currentColor,
            0 0 56px 22px #fff8;
    opacity: .95;
}

/* schegge (6) che partono dal centro in radiale */
.portalRoot :global(.explosion .ex-spark) {
    position: absolute;
    left: 50%; top: 50%;
    width: 6px; height: 6px;
    margin: -3px 0 0 -3px;
    background: #fff;
    box-shadow: 0 0 6px 2px currentColor;
    border-radius: 1px;
    animation: spark 0.9s ease-out forwards;
}

/* anelli concentrici (bordati) */
.portalRoot :global(.explosion::before),
.portalRoot :global(.explosion::after) {
    content: "";
    position: absolute;
    inset: -10px;
    border-radius: 50%;
    border: 4px solid currentColor;
    opacity: .7;
    animation: boom-ring .9s ease-out forwards;
}
.portalRoot :global(.explosion::after) {
    inset: -18px;
    opacity: .45;
    border-width: 3px;
    animation-delay: .05s;
}

/* ========================================================================
   ANIMAZIONI ESPLOSIONE
   ======================================================================== */
@keyframes boom {
    0%   { transform: scale(0.45); opacity: 1; }
    60%  { transform: scale(2.6);  opacity: .95; }
    100% { transform: scale(3.5);  opacity: 0; }
}
@keyframes boom-ring {
    0%   { transform: scale(0.6); opacity: .85; }
    100% { transform: scale(2.7); opacity: 0; }
}
@keyframes spark {
    0%   { transform: translate(0,0) scale(1);   opacity: 1; }
    70%  { transform: translate(var(--dx), var(--dy)) scale(0.9); opacity: .9; }
    100% { transform: translate(calc(var(--dx) * 1.2), calc(var(--dy) * 1.2)) scale(0.6); opacity: 0; }
}

/* ========================================================================
   TOGGLE (fuori dal portal, resta sopra l‚ÄôUI)
   ======================================================================== */
.gameToggle {
    position: fixed;
    bottom: 14px;
    left: 14px;
    z-index: 30;
    padding: .4rem .6rem;
    background: var(--color-primary);
    color: var(--color-black);
    border: 2px solid var(--color-primary);
    cursor: pointer;
    font-family: var(--font-press-start, "Press Start 2P", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif);
    font-size: .8rem;
    box-shadow: 2px 2px 0 var(--color-primary);
}

/* ========================================================================
   RESPONSIVE
   ======================================================================== */
@media (max-width: 600px) {
    .portalRoot :global(.ship-shape) { width: 54px; height: 60px; }
}
